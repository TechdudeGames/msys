diff -urN bzip2-1.0.1-orig/CYGWIN-PATCHES/bzip2-1.0.1.README bzip2-1.0.1/CYGWIN-PATCHES/bzip2-1.0.1.README
--- bzip2-1.0.1-orig/CYGWIN-PATCHES/bzip2-1.0.1.README	Wed Dec 31 19:00:00 1969
+++ bzip2-1.0.1/CYGWIN-PATCHES/bzip2-1.0.1.README	Mon Oct 23 13:46:27 2000
@@ -0,0 +1,106 @@
+The source archive already has the appropriate cygwin patch applied.
+To remove and revert to a 'clean' bzip2-1.0.1:
+  mv <srctop>/CYGWIN-PATCHES/bzip2-1.0.1-X.patch <srctop>/..
+  cd <srctop>
+  patch -p1 -R < ../bzip2-1.0.1-X.patch
+  
+------------------
+
+Requirements:
+  gcc-2.95.2-2 or later
+       this was released around June 19, 2000. The bzip2 makefile uses
+       new gcc switches and features introduced at that time) 
+  binutils-20000722-1 or later 
+       this was released around July 27, 2000. The bzip2 makefile uses
+       new ld switches and features introduced in that binutils release)
+
+Direct Dependencies:
+  none
+
+Canonical homepage:
+http://sources.redhat.com/bzip2/
+
+Canonical download:
+ftp://sourceware.cygnus.com/pub/bzip2/v100/
+
+------------------
+
+To link this library with your projects:
+  #1) include bzlib.h
+  #2) to link with the static library, use '-static' on the link line and
+      use '-DBZLIB_STATIC' when compiling your .c into a .o
+  #3) to link with the dll compile and link as usual; no special flags
+      or -Ddefines are necessary
+
+See the makefile and inspect how bzip2.exe is built (with the dll)
+and how bzip2-stat.exe is built (with the static lib).
+
+------------------
+
+To build the library for cygwin: 
+
+unpack bzip2-1.0.1-X-src.tar.gz
+cd bzip2-1.0.1
+make
+make test 
+make install
+
+This will build both a static lib and a dll with an import library.
+It will also build and run the tests using both versions of the 
+library, so you will see two identical outputs when running 'make test'. 
+
+------------------
+
+Files included in the binary distro
+
+  <prefix>/lib/libbz2.a
+  <prefix>/lib/libbz2.dll.a
+  <prefix>/bin/cygbz2.dll
+  <prefix>/bin/bzip2.exe
+  <prefix>/bin/bunzip2.exe
+  <prefix>/bin/bzcat.exe
+  <prefix>/bin/bzip2recover.exe
+  <prefix>/include/bzlib.h
+  <prefix>/man/man1/bzip2.1
+  <prefix>/doc/bzip2-1.0.1/CHANGES
+  <prefix>/doc/bzip2-1.0.1/LICENSE
+  <prefix>/doc/bzip2-1.0.1/manual.ps
+  <prefix>/doc/bzip2-1.0.1/manual.texi
+  <prefix>/doc/bzip2-1.0.1/manual_1.html
+  <prefix>/doc/bzip2-1.0.1/manual_2.html
+  <prefix>/doc/bzip2-1.0.1/manual_3.html
+  <prefix>/doc/bzip2-1.0.1/manual_4.html
+  <prefix>/doc/bzip2-1.0.1/manual_toc.html
+  <prefix>/doc/bzip2-1.0.1/README
+  <prefix>/doc/bzip2-1.0.1/Y2K_INFO
+  <prefix>/doc/Cygwin/bzip2-1.0.1.README
+  
+------------------
+
+Port Notes:
+
+As of 1.0.1-3, the dll is named "cygbz21.0.dll" NOT "libbz2.dll".  This 
+  helps to avoid dll naming conflicts between cygwin dll's and 
+  dlls from other platforms (native, pw, etc).  If you have an
+  executable that depends on "libbz2.dll" you may either recompile 
+  your app so that it links with libbz2.dll.a/cygbz21.0.dll, or install
+  *just* the dll from bzip-1.0.1-2.tar.gz into your /usr/bin 
+  directory.
+
+The dll is VERSIONED. (i.e. "cygbz21.0.dll" NOT "cygbz2.dll") because
+  the developers of bzip2 specify that sharedlibs on unix should have
+  a so-name of "1.0".  It appears that they are anticipating a
+  change in the ABI/API at some point in the future.  To enable the
+  the upcoming version(s) and this one to coexist, the dll's are
+  versioned (versioning is not necessary for static libs until
+  AFTER the release of the newer, incompatible library, but you've
+  got to think ahead for the dynamic libs).
+
+This '2' in 'bz2' is part of the library NAME, not a version number.
+  Thus, you have "cyg" + "bz2" + "so-version" == "cygbz21.0"
+
+The executables installed are the *statically* linked versions, 
+regardless of the name (e.g. bzip2-stat.exe is installed as 
+<prefix>/bin/bzip2.exe).
+
+Cygwin port maintained by: Michael Ring (michael-ring@t-online.de) 
diff -urN bzip2-1.0.1-orig/Makefile bzip2-1.0.1/Makefile
--- bzip2-1.0.1-orig/Makefile	Fri Jun 23 16:34:47 2000
+++ bzip2-1.0.1/Makefile	Mon Nov 20 18:49:31 2000
@@ -1,8 +1,43 @@
+VER=1.0.1
+SO_VER=1.0
+
+PREFIX=/usr
+prefix=$(PREFIX)
+exec_prefix=$(prefix)
+bindir=$(prefix)/bin
+libdir=$(prefix)/lib
+incdir=$(prefix)/include
+mandir=$(prefix)/man
+man1dir=$(mandir)/man1
+infodir=$(prefix)/info
+docdir=$(prefix)/doc/bzip2-$(VER)
+cygdocdir=$(prefix)/doc/Cygwin
 
 SHELL=/bin/sh
 CC=gcc
+STRIP=strip
+LN=cp
 BIGFILES=-D_FILE_OFFSET_BITS=64
 CFLAGS=-Wall -Winline -O2 -fomit-frame-pointer -fno-strength-reduce $(BIGFILES)
+INSTALL=install
+LDSHARED=gcc -shared -Wl,--enable-auto-image-base
+LDEXTRA=-Wl,--out-implib=$(IMPLIB) $(SHAREDDEF)
+
+DOCS=CHANGES LICENSE README Y2K_INFO manual.ps manual.texi manual_1.html \
+     manual_2.html manual_3.html manual_4.html manual_toc.html
+INFO=bzip2.info bzip2.info-1 bzip2.info-2 bzip2.info-3
+
+.SUFFIXES:
+.SUFFIXES: .c .o .pic.o .dyn.o
+
+%.o : %.c
+	$(CC) -c $(CFLAGS) -I. -DBZLIB_STATIC -o $@ $<
+
+%.pic.o : %.c
+	$(CC) -c $(CFLAGS) -I. -DBZLIB_DLL -o $@ $<
+
+%.dyn.o : %.c
+	$(CC) -c $(CFLAGS) -I. -o $@ $<
 
 OBJS= blocksort.o  \
       huffman.o    \
@@ -12,24 +47,40 @@
       decompress.o \
       bzlib.o
 
-all: libbz2.a bzip2 bzip2recover test
-
-bzip2: libbz2.a bzip2.o
-	$(CC) $(CFLAGS) -o bzip2 bzip2.o -L. -lbz2
+OBJS_DLL= ${OBJS:.o=.pic.o}
 
-bzip2recover: bzip2recover.o
-	$(CC) $(CFLAGS) -o bzip2recover bzip2recover.o
+SHAREDLIB=cygbz2${SO_VER}.dll
+STATLIB=libbz2.a
+IMPLIB=libbz2.dll.a
+SHAREDDEF=libbz2.def
+EXE=.exe
+
+all: ${STATLIB} ${SHAREDLIB} bzip2$(EXE) bzip2-stat$(EXE) \
+	bzip2recover$(EXE) bzip2recover-stat$(EXE) \
+	$(INFO) test
+
+bzip2$(EXE): bzip2.dyn.o $(STATLIB)
+	$(CC) $(CFLAGS) -o $@ $< -L. -lbz2
+bzip2-stat$(EXE): bzip2.o $(STATLIB)
+	$(CC) -static $(CFLAGS) -o $@ $< -L. -lbz2
+
+bzip2recover$(EXE): bzip2recover.dyn.o
+	$(CC) $(CFLAGS) -o $@ $<
+bzip2recover-stat$(EXE): bzip2recover.o
+	$(CC) -static $(CFLAGS) -o $@ $<
+
+$(STATLIB): $(OBJS)
+	rm -f $(STATLIB)
+	ar cq $(STATLIB) $(OBJS)
+	ranlib $(STATLIB)
+
+$(SHAREDLIB): $(OBJS_DLL)
+	rm -f $(SHAREDLIB) $(IMPLIB)
+	$(LDSHARED) -o $@ $(LDEXTRA) $(OBJS_DLL)
 
-libbz2.a: $(OBJS)
-	rm -f libbz2.a
-	ar cq libbz2.a $(OBJS)
-	@if ( test -f /usr/bin/ranlib -o -f /bin/ranlib -o \
-		-f /usr/ccs/bin/ranlib ) ; then \
-		echo ranlib libbz2.a ; \
-		ranlib libbz2.a ; \
-	fi
+test: test-dyn test-stat
 
-test: bzip2
+test-dyn: bzip2$(EXE)
 	@cat words1
 	./bzip2 -1  < sample1.ref > sample1.rb2
 	./bzip2 -2  < sample2.ref > sample2.rb2
@@ -45,53 +96,62 @@
 	cmp sample3.tst sample3.ref
 	@cat words3
 
-PREFIX=/usr
+test-stat: bzip2-stat$(EXE)
+	@cat words1
+	./bzip2-stat -1  < sample1.ref > sample1.rb2
+	./bzip2-stat -2  < sample2.ref > sample2.rb2
+	./bzip2-stat -3  < sample3.ref > sample3.rb2
+	./bzip2-stat -d  < sample1.bz2 > sample1.tst
+	./bzip2-stat -d  < sample2.bz2 > sample2.tst
+	./bzip2-stat -ds < sample3.bz2 > sample3.tst
+	cmp sample1.bz2 sample1.rb2 
+	cmp sample2.bz2 sample2.rb2
+	cmp sample3.bz2 sample3.rb2
+	cmp sample1.tst sample1.ref
+	cmp sample2.tst sample2.ref
+	cmp sample3.tst sample3.ref
+	@cat words3
 
-install: bzip2 bzip2recover
-	if ( test ! -d $(PREFIX)/bin ) ; then mkdir $(PREFIX)/bin ; fi
-	if ( test ! -d $(PREFIX)/lib ) ; then mkdir $(PREFIX)/lib ; fi
-	if ( test ! -d $(PREFIX)/man ) ; then mkdir $(PREFIX)/man ; fi
-	if ( test ! -d $(PREFIX)/man/man1 ) ; then mkdir $(PREFIX)/man/man1 ; fi
-	if ( test ! -d $(PREFIX)/include ) ; then mkdir $(PREFIX)/include ; fi
-	cp -f bzip2 $(PREFIX)/bin/bzip2
-	cp -f bzip2 $(PREFIX)/bin/bunzip2
-	cp -f bzip2 $(PREFIX)/bin/bzcat
-	cp -f bzip2recover $(PREFIX)/bin/bzip2recover
-	chmod a+x $(PREFIX)/bin/bzip2
-	chmod a+x $(PREFIX)/bin/bunzip2
-	chmod a+x $(PREFIX)/bin/bzcat
-	chmod a+x $(PREFIX)/bin/bzip2recover
-	cp -f bzip2.1 $(PREFIX)/man/man1
-	chmod a+r $(PREFIX)/man/man1/bzip2.1
-	cp -f bzlib.h $(PREFIX)/include
-	chmod a+r $(PREFIX)/include/bzlib.h
-	cp -f libbz2.a $(PREFIX)/lib
-	chmod a+r $(PREFIX)/lib/libbz2.a
+$(INFO): manual.texi
+	makeinfo manual.texi
+
+install: bzip2-stat$(EXE) bzip2recover-stat$(EXE) $(INFO)
+	if ( test ! -d $(bindir) ) ; then mkdir -p $(bindir) ; fi
+	if ( test ! -d $(libdir) ) ; then mkdir -p $(libdir) ; fi
+	if ( test ! -d $(mandir) ) ; then mkdir -p $(mandir) ; fi
+	if ( test ! -d $(man1dir) ) ; then mkdir -p $(man1dir) ; fi
+	if ( test ! -d $(incdir) ) ; then mkdir -p $(incdir) ; fi
+	if ( test ! -d $(docdir) ) ; then mkdir -p $(docdir) ; fi
+	if ( test ! -d $(cygdocdir) ) ; then mkdir -p $(cygdocdir) ; fi
+	if ( test ! -d $(infodir) ) ; then mkdir -p $(infodir) ; fi
+	install -m 755 -s bzip2-stat$(EXE) $(bindir)/bzip2$(EXE)
+	install -m 755 -s bzip2-stat$(EXE) $(bindir)/bunzip2$(EXE)
+	install -m 755 -s bzip2-stat$(EXE) $(bindir)/bzcat$(EXE)
+	install -m 755 -s bzip2recover-stat$(EXE) $(bindir)/bzip2recover$(EXE)
+	install -m 644 bzip2.1 $(man1dir)
+	install -m 644 bzlib.h $(incdir)
+	install -m 644 $(STATLIB) $(libdir)
+	install -m 644 $(IMPLIB) $(libdir)
+	install -m 644 -s $(SHAREDLIB) $(bindir)
+	install -m 644 CYGWIN-PATCHES/bzip2-$(VER).README $(cygdocdir)
+	install -m 644 $(DOCS) $(docdir)
+	install -m 644 $(INFO) $(infodir)
+	install-info --info-dir=$(infodir) --info-file=$(infodir)/bzip2.info
 
 clean: 
-	rm -f *.o libbz2.a bzip2 bzip2recover \
+	rm -f *.o $(STATLIB) $(SHAREDLIB) $(IMPLIB) \
+	bzip2-stat$(EXE) bzip2recover-stat$(EXE) \
+	bzip2$(EXE) bzip2recover$(EXE) \
 	sample1.rb2 sample2.rb2 sample3.rb2 \
-	sample1.tst sample2.tst sample3.tst
+	sample1.tst sample2.tst sample3.tst \
+	$(INFO)
 
 blocksort.o: blocksort.c
 	@cat words0
-	$(CC) $(CFLAGS) -c blocksort.c
-huffman.o: huffman.c
-	$(CC) $(CFLAGS) -c huffman.c
-crctable.o: crctable.c
-	$(CC) $(CFLAGS) -c crctable.c
-randtable.o: randtable.c
-	$(CC) $(CFLAGS) -c randtable.c
-compress.o: compress.c
-	$(CC) $(CFLAGS) -c compress.c
-decompress.o: decompress.c
-	$(CC) $(CFLAGS) -c decompress.c
-bzlib.o: bzlib.c
-	$(CC) $(CFLAGS) -c bzlib.c
-bzip2.o: bzip2.c
-	$(CC) $(CFLAGS) -c bzip2.c
-bzip2recover.o: bzip2recover.c
-	$(CC) $(CFLAGS) -c bzip2recover.c
+	$(CC) -c $(CFLAGS) -I. -DBZLIB_STATIC -o $@ $<
+blocksort.pic.o: blocksort.c
+	@cat words0
+	$(CC) -c $(CFLAGS) -I. -DBZLIB_DLL -o $@ $<
 
 DISTNAME=bzip2-1.0.1
 tarfile:
diff -urN bzip2-1.0.1-orig/bzlib.c bzip2-1.0.1/bzlib.c
--- bzip2-1.0.1-orig/bzlib.c	Wed Apr  5 19:24:41 2000
+++ bzip2-1.0.1/bzlib.c	Wed Jul 12 06:53:27 2000
@@ -1365,7 +1365,7 @@
 #ifndef BZ_NO_STDIO
 /*---------------------------------------------------*/
 
-#if defined(_WIN32) || defined(OS2) || defined(MSDOS)
+#if ( defined(_WIN32) && !defined(__CYGWIN__) ) || defined(OS2) || defined(MSDOS)
 #   include <fcntl.h>
 #   include <io.h>
 #   define SET_BINARY_MODE(file) setmode(fileno(file),O_BINARY)
diff -urN bzip2-1.0.1-orig/bzlib.h bzip2-1.0.1/bzlib.h
--- bzip2-1.0.1-orig/bzlib.h	Wed Apr  5 19:24:50 2000
+++ bzip2-1.0.1/bzlib.h	Fri Aug  4 20:56:58 2000
@@ -105,12 +105,11 @@
    } 
    bz_stream;
 
-
 #ifndef BZ_IMPORT
 #define BZ_EXPORT
 #endif
 
-#ifdef _WIN32
+#if defined(_WIN32) && !defined(__CYGWIN__)
 #   include <stdio.h>
 #   include <windows.h>
 #   ifdef small
@@ -125,6 +124,32 @@
 #   define BZ_API(func) (WINAPI * func)
 #   define BZ_EXTERN
 #   endif
+#elif defined(__CYGWIN__)
+#  if defined(BZLIB_DLL)
+#    if defined(BZLIB_STATIC)
+#      undef BZLIB_STATIC
+#    endif
+#  endif
+#  if defined(BZLIB_DLL)
+/* building a DLL */
+#    define BZLIB_IMPEXP __declspec(dllexport)
+#  elif defined(BZLIB_STATIC)
+/* building or linking to a static library */
+#    define BZLIB_IMPEXP
+#  else
+/* linking to the DLL */
+#    define BZLIB_IMPEXP __declspec(dllimport)
+#  endif
+#
+#  if !defined(BZLIB_API)
+#    define BZLIB_API __cdecl
+#  endif
+#  if !defined(BZ_API)
+#    define BZ_API(func) BZLIB_IMPEXP BZLIB_API func
+#  endif
+#  if !defined(BZ_EXTERN)
+#    define BZ_EXTERN extern
+#  endif
 #else
 #   define BZ_API(func) func
 #   define BZ_EXTERN extern
diff -urN bzip2-1.0.1-orig/libbz2.def bzip2-1.0.1/libbz2.def
--- bzip2-1.0.1-orig/libbz2.def	Tue May 16 17:35:52 2000
+++ bzip2-1.0.1/libbz2.def	Mon Nov 20 18:03:19 2000
@@ -1,27 +1,26 @@
-LIBRARY			LIBBZ2
-DESCRIPTION		"libbzip2: library for data compression"
-EXPORTS
-	BZ2_bzCompressInit
-	BZ2_bzCompress
-	BZ2_bzCompressEnd
-	BZ2_bzDecompressInit
-	BZ2_bzDecompress
-	BZ2_bzDecompressEnd
-	BZ2_bzReadOpen
-	BZ2_bzReadClose
-	BZ2_bzReadGetUnused
-	BZ2_bzRead
-	BZ2_bzWriteOpen
-	BZ2_bzWrite
-	BZ2_bzWriteClose
-	BZ2_bzWriteClose64
-	BZ2_bzBuffToBuffCompress
-	BZ2_bzBuffToBuffDecompress
-	BZ2_bzlibVersion
-	BZ2_bzopen
-	BZ2_bzdopen
-	BZ2_bzread
-	BZ2_bzwrite
-	BZ2_bzflush
-	BZ2_bzclose
-	BZ2_bzerror
+EXPORTS
+	BZ2_bzCompressInit @1
+	BZ2_bzCompress @2
+	BZ2_bzCompressEnd @3
+	BZ2_bzDecompressInit @4
+	BZ2_bzDecompress @5
+	BZ2_bzDecompressEnd @6
+	BZ2_bzReadOpen @7
+	BZ2_bzReadClose @8
+	BZ2_bzReadGetUnused @9
+	BZ2_bzRead @10
+	BZ2_bzWriteOpen @11
+	BZ2_bzWrite @12
+	BZ2_bzWriteClose @13
+	BZ2_bzWriteClose64 @14
+	BZ2_bzBuffToBuffCompress @15
+	BZ2_bzBuffToBuffDecompress @16
+	BZ2_bzlibVersion @17
+	BZ2_bzopen @18
+	BZ2_bzdopen @19
+	BZ2_bzread @20
+	BZ2_bzwrite @21
+	BZ2_bzflush @22
+	BZ2_bzclose @23
+	BZ2_bzerror @24
+
diff -urN bzip2-1.0.1-orig/manual.texi bzip2-1.0.1/manual.texi
--- bzip2-1.0.1-orig/manual.texi	Thu Mar 23 18:43:33 2000
+++ bzip2-1.0.1/manual.texi	Mon Nov 20 18:39:40 2000
@@ -42,6 +42,11 @@
 @end iftex
 @node Top, Overview, (dir), (dir)
 
+@menu
+* Overview::			overview
+* Implementation::		internals
+@end menu
+
 This program, @code{bzip2}, 
 and associated library @code{libbzip2}, are
 Copyright (C) 1996-2000 Julian R Seward.  All rights reserved.
@@ -132,7 +137,7 @@
 @quotation
 
 @unnumberedsubsubsec NAME
-@itemize
+@itemize @bullet
 @item @code{bzip2}, @code{bunzip2}
 - a block-sorting file compressor, v1.0
 @item @code{bzcat} 
@@ -142,7 +147,7 @@
 @end itemize
 
 @unnumberedsubsubsec SYNOPSIS
-@itemize
+@itemize @bullet
 @item @code{bzip2} [ -cdfkqstvzVL123456789 ] [ filenames ...  ]
 @item @code{bunzip2} [ -fkvsVL ] [ filenames ...  ]
 @item @code{bzcat} [ -s ] [ filenames ...  ]
@@ -183,7 +188,7 @@
 will be detected and ignored, and a warning issued.  
 @code{bzip2} attempts to guess the filename for the decompressed file 
 from that of the compressed file as follows:
-@itemize
+@itemize @bullet
 @item @code{filename.bz2 } becomes @code{filename}
 @item @code{filename.bz  } becomes @code{filename}
 @item @code{filename.tbz2} becomes @code{filename.tar}
@@ -2208,6 +2213,8 @@
      Snowbird, Utah.  28-30 March 2000.
 @end example
 
+@node Implementation,  , Overview, Top
+Placeholder to quiet makeinfo errors.
 
 @contents
 
